{
  "$schema": "http://json-schema.org/draft/2019-09/schema",
  "title": "ISO/IEC 23090-8:2020 Network Based Media Processing schema-definitions",
  "scheme": { 
    "title": "Scheme Descriptor Schema",
    "type": "object",
    "required": [
      "uri"
    ],
    "properties": {
      "uri": {
        "type": "string",
        "format":"uri"
      }
    }
  },
  "general": {
    "title": "General Descriptor Schema",
    "type": "object",
    "required": [
        "id", "name", "description",
        "input-ports","output-ports", "state"
        ],  
    "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "rank": {
          "type": "integer",
          "minimum": 0
        },
        "mpeg-compatibility": {
          "type": "string",
          "format": "uri",
          "pattenrProperties":{
            "^urn:mpeg:mpegi:nbmp:v": {"type" : "string"}
          },
          "additionalProperties": "false"
        },
        "published-time": {
          "type": "string",
          "format": "date-time"
        },
        "priority": {
          "type": "number"
        },
        "input-ports": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "object",
            "required": ["port-name", "bind"],
            "properties": {
              "port-name": {
                "type": "string"
              },
              "bind": {
                "type": "object",
                "required": ["stream_id", "name"],
                "properties": {
                  "stream-id": {
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  },
                  "keywords": {
                    "type": "array",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "output-ports": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "object",
            "required": ["port-name", "bind"],
            "properties": {
              "port-name": {
                "type": "string"
              },
              "bind": {
                "type": "object",
                "required": ["stream_id", "name"],
                "properties": {
                  "stream-id": {
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  },
                  "keywords": {
                    "type": "array",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },    
        "is-group": {
        "type": "boolean",
        "default": false
        },
        "state": {
        "type": "string"
        }
      }
  },
  "input" : {
    "title": "Input Descriptor Schema",
    "type": "object",
    "required": ["media-parameters", "metadata-parameters"],
    "properties": {
      "media-parameters": {
        "type": "array",
        "minItems": 0,
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required": [
            "stream-id", "name", "keywords", "mime-type", "data-type", "protocol","caching-server-url"
          ],
          "properties": {
            "stream-id": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "keywords": {
              "type": "array",
              "minItems": 1,
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "mime-type": {
              "type": "string"
            },
            "video-format": {
              "type": "string"
            },
            "audio-format": {
              "type": "string"
            },
            "image-type": {
              "type": "string"
            },
            "protocol" : {
              "type": "string"
            },
            "throughput": {
              "type": "integer",
              "minimum": 0
            },
            "buffersize": {
              "type": "integer",
              "minimum": 0
            },
            "caching-server-url": {
              "type": "string",
              "format": "uri"  
            }
          }
        }
        },
        "metadata-parameters": {
          "type": "array",
          "items": {
            "type": "object",
            "minItems": 0,
            "uniqueItems": true,
            "required": [
              "stream-id", "name", "keywords", "mime-type", "protocol"
            ],
            "properties": {
              "stream-id": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "keywords": {
                "type": "array",
                "minItems": 1,
                "uniqueItems": true,
                "items": {
                    "type": "string"
                }
              },
              "mime-type": {
                "type": "string"
              },
              "codec-type": {
                "type": "string"
              },
              "protocol": {
                "type": "string"
              },
              "max-size": {
                "type": "integer",
                "minimum": 0
              },
              "min-interval": {
                "type": "integer",
                "minimum": 0
              },
              "caching-server-url": {
                "type": "string"    
              },
              "scheme-uri": {
                "type": "string",
                "format": "uri"    
            }
          }
        }
      }
    }
  },
  "output" : {
    "title": "Output Descriptor Schema",
    "type": "object",
    "required": ["media-parameters", "metadata-parameters"],
    "properties": {
      "media-parameters": {
        "type": "array",
        "minItems": 0,
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required": [
            "stream-id", "name", "keywords", "mime-type", "protocol", "caching-server-url"
          ],
          "properties": {
            "stream-id": {
                "type": "string"
            },
            "name": {
                "type": "string"
            },
            "keywords": {
              "type": "array",
              "minItems": 1,
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "mime-type": {
              "type": "string"
            },
            "video-format": {
              "type": "string"
            },
            "audio-format": {
              "type": "string"
            },
            "image-format": {
              "type": "string"
            },
            "codec-type": {
              "type": "string"
            },
            "protocol" : {
              "type": "string"
            },
            "throughput": {
              "type": "integer",
              "minimum": 0
            },
            "buffersize": {
              "type": "integer",
              "minimum": 0
            },
            "caching-server-url": {
              "type": "string",
              "format": "uri"    
            }
          }
        }
      },
      "metadata-parameters": {
        "type": "array",
        "minItems": 0,
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required": [
            "stream-id", "name", "keywords", "mime-type", "codec-type", "protocol", "caching-server-url"
          ],
          "properties": {
            "stream-id": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "keywords": {
              "type": "array",
              "minItems": 1,
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "mime-type": {
              "type": "string"
            },
            "codec-type": {
              "type": "string"
            },
            "protocol" : {
              "type": "string"
            },
            "max-size": {
              "type": "integer",
              "minimum": 0
            },
            "min-interval": {
              "type": "integer",
              "minimum": 0
            },
            "caching-server-url": {
              "type": "string",
              "format": "uri"     
            },
            "scheme-uri": {
              "type": "string",
              "format": "uri"    
            }
          }
        }
      }
    }
  },
  "processing": {
    "title": "Processing Descriptor Schema",
    "type": "object",
    "required": [
      "keywords",
      "image"
    ],
    "properties": {
      "keywords": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "string"
        }
      },
      "image": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required" : [ "url"],
          "properties": {
            "is-dynamic": { 
              "type": "boolean",
              "default": "false"
            },
            "url": {
              "type": "string",
              "format": "url"
            },
            "static-image-info":{
              "type": "object",
              "required": [
                "os", "version", "architecture", "environment"
              ],
              "properties": {
                "os":{ "type": "string"},
                "version":{ "type": "string"},
                "architecture":{ "type": "string"},
                "environment":{ "type": "string"},
                "patch-url":{ 
                  "type": "string",
                  "format": "url"
                },
                "patch-script":{ 
                  "type": "string",
                  "format": "url"
                }
              }
            },
            "dynamic-image-info":{
              "type": "object",
              "required": ["scheme", "information"],
              "properties": {
                "pscheme":{ 
                  "type": "string",
                  "format": "url"
                },
                "information":{ "type": "object"}
              }
            }
          }
        }
      },
      "start-time": {
        "type": "string",
        "format": "date-time"
      },
      "connection-map": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": [
          {
            "type": "object",
            "required": [
              "from", "to"
            ],
            "properties": {
              "from":{
                "type": "object",
                "required": [
                  "id",
                  "instance",
                  "port-name"
                ],
                "properties": {
                  "id" : {
                    "type": "string"
                  },
                  "instance": {
                    "type": "string"
                  },
                  "port-name": {
                    "type": "string"
                  },
                  "output-restrictions": {
                    "$ref": "#/definitions/output"
                  }
                }
              },
              "to": {
                "type": "object",
                "required": [
                  "id",
                  "instance",
                  "port-name"
                ],
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "instance": {
                    "type": "string"
                  },
                  "port-name": {
                    "type": "string"
                  },
                  "input-restrictions": {
                    "$ref": "#/definitions/input"
                  }
                }
              },
              "flowcontrol-parameters": {
                "type": "object"
              },
              "co-located": {
                "type": "boolean",
                "default": "false"
              },
              "other-parameters": {
                "type": "object"
              }
            }
          }
        ]
      },
      "function-restrictions": {
        "type": "array",
        "uniqueItems": true,
        "items": [
          {
            "type": "object",
            "required": [
              "instance"
            ],
            "properties": {
              "instance": {
                "type": "string"
              },
              "general": {
                "$ref": "#/definitions/general"
              },
              "processing": {
                "$ref": "#/definitions/processing"
              },
              "requirements": {
                "$ref": "#/definitions/requirements"
              },
              "configuration": {
                "$ref": "#/definitions/configuration"
              },
              "client-assistant": {
                "$ref": "#/definitions/client-assistant"
              },
              "monitoring": {
                "$ref": "#/definitions/monitoring"
              }
            }
          }
        ]
      }
    }     
  },
  "requirement": {
    "title": "Requirements Descriptor Schema",
    "type": "object",
    "properties": {
      "flowcontrol-requirements": {
        "type": "object",
        "minProperties" : 1,
        "properties": {
          "typical-delay": {
          "type": "integer",
          "minimum": 0
          },
          "min-delay": {
            "type": "integer",
            "minimum": 0
          },
          "max-delay": {
            "type": "integer",
            "minimum": 0
          },
          "typical-throughput": {
            "type": "integer",
            "minimum": 0
          },
          "min-throughput": {
            "type": "integer",
            "minimum": 0
          },
          "max-throughput": {
            "type": "integer",
            "minimum": 0
          },
          "averaging-window": {
            "type": "integer",
            "minimum": 0
          }
        }
      },
      "hardware-requirements": {
        "type": "object",
        "minProperties" : 1,
        "properties": {
          "vcpu": {
            "type": "integer",
            "minimum": 0
          },
          "vgpu": {
            "type": "integer",
            "minimum": 0
          },
          "ram": {
            "type": "integer",
            "minimum": 0
          },
          "disk": {
            "type": "integer",
            "minimum": 0
          },
          "placement": {
            "type": "string",
            "pattern": "(^[a-z]{2}$)|(^[a-z]{2}-.*)"
          }
        }
      },
      "security-requirements": {
        "type": "object",
        "minProperties" : 1,
        "properties": {
          "tls": {
            "type": "boolean",
            "default": "false"
          },
          "ipsec": {
            "type": "boolean",
            "default": "false"
          },
          "cenc": {
              "type": "boolean",
              "default": "false"
          }
        }
      },
      "workflow-task-requirements": {
        "type": "object",
        "minProperties" : 1,
        "properties": {
          "execution-mode": {
            "type": "string",
            "default": "streaming"
          },
          "function-fusible": {
            "type": "boolean",
            "default": "false"
          },
          "function-enhancable": {
            "type": "boolean",
            "default": "false"
          }
        }
      },
      "resource-estimators": {
        "type": "object",
        "required": ["default-values"],
        "properties": {
          "default-values": {
            "type": "array",
            "minItems": 1,
            "items": {
              "name" : {"type": "string"},
              "value": {"type": "string"}
            }
          },
          "computational-estimator": {
            "type": "string"
          },
          "memory-estimator": {
            "type": "string"
          },
          "bandwidth-estimator": {
            "type": "string"
          }
        }
      }
    }
  },
  "configuration": { 
    "title": "Configuration Descriptor Schema",
    "type": "object",
    "required": [ "parameters" ],
    "properties": {
      "parameters": {
        "type": "array",
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required": [
            "name", "id", "type"
          ],
          "properties": {
            "name": {
              "type": "string"
            },
            "id": {
              "type": "integer"
            },
            "type": {
              "type": "string",
              "enum": [
                "simple", "enum", "range", "class"
              ]
            },
            "datatype": {
              "type": "string",
              "enum": [
                "boolean", "interger", "unsigned-integer", "float", "string", "object", "other"
              ]
            },
            "default": {
              "type": "object"
            },
            "restrictions": {
              "type": "object",
              "properties": {
                "enum-values": {
                  "type": "array",
                  "uniqueItems": true,
                  "items": {
                    "type": "string"
                  }
                },
                "int-range": {
                  "type": "object",
                  "properties": {
                    "min-value": {
                      "type": "integer"
                    },
                    "max-value": {
                      "type": "integer"
                    },
                    "increment": {
                      "type": "integer" 
                    }
                  }
                },
                "float-range": {
                  "type": "object",
                  "properties": {
                    "min-value": {
                      "type": "number"
                    },
                    "max-value": {
                      "type": "nmber"
                    },
                    "increment": {
                      "type": "number" 
                    }
                  }
                }
              }
            },
            "conditions": {
              "type": "array",
              "uniqueItems": true,
              "description": "List of configurarion ids",
              "items": {
                "type": "integer"
              }
            },
            "exclusion": {
              "type": "array",
              "description": "List of configurarion ids",
              "uniqueItems": true,
              "items": {
                "type": "integer"
              }
            }
          }
        }  
      }
    }   
  },
  "startup-delay": { 
    "title": "Startup-delay Descriptor Schema",
    "type": "object",
    "required": ["startup-delay" ],
    "properties": {
      "startup-delay": {
        "type": "integer",
        "minimum": 0
      }
    }
  },
  "client-assistant": { 
      "title": "Client-Assistance Descriptor Schema ",
      "type": "object",
      "required": [
        "client-assistance-flag"
      ],
      "properties": {
        "client-assistance-flag": {
          "type": "boolean",
          "default": "false"
        },
        "measurement-collection-list": {
          "type": "object"
        },
        "source-assistance-information ": {
          "type": " object"
        }
      }
  },
  "failover": { 
    "title": "Failover Descriptor Schema",
    "type": "object",
    "required": [
      "failover-mode", "failover-delay"
    ],
    "properties": {
      "failover-mode": {
        "type": "string",
        "enum:": ["restart-immediately", "restart-with-delay", "continue-with-last-good-state", "execute-backup-deployment", "exist"]
      },
      "failover-delay": {
        "type": "integer",
        "minimum": 0
      },
      "backup-deployment-url": {
        "type": "string",
        "format": "url"
      },
      "persistence-url": {
        "type": "string",
        "format": "url"
      },
      "persistence-interval": {
        "type": "integer",
        "minimum": 0
      }
    }
  }, 
  "events": {
    "title": "Events Descriptor Schema",
    "type": "array",
    "minItems": 1,
    "uniqueItems": true,
    "items" : {
        "properties": {
          "name": {"type": "string"},
          "definition": {"type": "string"},
          "url": {
            "type": "string",
            "format": "uri"
          }
        }
    }
  },
  "variables": {
    "title": "Variables Descriptor Schema",
    "properties" : {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items" : {
        "required": ["name", "definition", "unit", "var-type", "value"],
        "properties": {
          "name": {"type": "string"},
          "definition": {"type": "string"},
          "unit": {"type": "string"},
          "var-type": {
            "type" : "string",
            "enum" : ["string", "interger", "float", "boolean"]         
          },
          "value": {"type": "string"},
          "min" :{"type": "integer"},
          "max" :{"type": "integer"},
          "url": {
            "type": "string",
            "format": "url"
          },
          "children": {
            "type" : "array",
            "uniqueItems": true,
            "items" : { "$ref": "#/variables" },
            "default" : []
          }
        }
      }
    }
  },
  "monitoring": { 
    "title": "Monitoring Descriptor Schema",
    "type": "object",
    "minProperties": 1,
    "properties": { 
      "event": { "$ref": "#/events" },
      "variable": { "$ref": "#/variables" },
      "system-events": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object"
        }
      },
      "system-variables": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object"
        }
      }
    }
  },    
  "assertion": {
    "title": "Assertion Descriptor Schema",
    "type": "object",
    "required": [
        "min-priority", "min-priority-action", "assertion"
    ],
    "properties": {
      "min-priority":{
        "type": "integer",
        "minimum": 0
      },
      "min-priority-action":{
        "type": "string"
      }, 
      "support-verification": {
        "type": "boolean",
        "default": "false"
      },
      "verification-acknowledgement": {
        "type": "string"
      },
      "certificate": {
        "type": "string"
      },
      "assertion": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required": [
            "name", "value-predicate"
          ],
          "properties": {
            "name" : {
              "type": "string"
              },
            "value-predicate": {
              "type": "object",
              "required": [
                "evaluation-condition", "check-value", "aggregation", "priority", "action"
              ],
              "properties": {
                "evaluation-condition": {
                  "type": "string",
                  "enum": ["quality", "computational", "input", "output"]
                },
                "check-value": {
                  "type": "object"
                },
                "aggregation": {
                  "type": "string",
                  "enum": ["sum", "min", "max", "avg"]
                },
                "offset": {
                  "type": "string"
                },
                "priority": {
                  "type": "integer",
                  "minimum": 0
                },
                "action": {
                  "type": "string",
                  "enum": ["rebuild", "restart", "wait"]
                },
                "action-parameters": {
                  "type": "array",
                  "minItems": 1,
                  "uniqueItems": true,
                  "item": { "type": "string"}
                }
              }
            }
          }
        }
      }
    }
  },
  "reporting": { 
    "title": "Reporting Descriptor Schema",
    "type": "object",
    "required": [ "reporting-type", "reporting-interval", "report-start-time", "url", "delivery-method"
    ],
    "properties": {
      "event": { "$ref": "#/events" },
      "variable": { "$ref": "#/variables" },
      "system-events": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object"
        }
      },
      "system-variables": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object"
        }
      },
      "report-type": {
        "type": "string"
      },
      "reporting-interval": {
        "type": "integer",
        "minimum": 0
      },
      "report-start-time": {
        "type": "string",
        "format": "date-time"
      },
      "url": {
        "type": "string",
        "format": "url"
      },
      "delivery-method": {
        "type": "string",
        "default": "HTTP POST"
      }
    }
  },
  "notification": { 
    "title": "Notifications Descriptor Schema",
    "type": "object",
    "required": [
      "notification-time", "severity-level", "notification-type","urls"
    ],
    "properties": {
      "event": { "$ref": "#/events" },
      "variable": { "$ref": "#/variables" },
      "system-events": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object"
        }
      },
      "system-variables": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object"
        }
      },
      "notification-time": {
        "type": "string",
        "format": "date-time"
      },
      "severity-level": {
        "type": "string"
      },
      "notification-type": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "string",
          "enum": ["congestion", "application", "system"]
        } 
      },
      "urls": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "string",
          "format": "url"
        }
      },
      "notification-interval": {
        "type": "integer",
        "minimum": 0,
        "default": 0
      }
    }
  },
  "request": {
    "title": "Request Descriptor Schema",
    "type": "object",
    "required": ["request-id", "task-id"],
    "properties": {
      "request-id": {
        "type": "integer",
        "minimum": 0
      },
      "priority": {
        "type": "integer",
        "minimum": 0 
      }, 
      "task-id": {
        "type": "string"
      }
    }    
  },    
  "acknowledge": {
    "title": "Acknowledge Descriptor Schema",
    "type": "object",
    "required": ["status"],
    "properties": {
      "status": {
        "type": "string",
        "enum": ["fulfilled", "failed", "not-supported", "partially-fulfilled"]
      },
      "unsupported": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {"type": "string"}
      },
      "failed": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {"type": "string"}
      },
      "partial": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {"type": "string"}
      }
    }
  },
  "repository": {
    "title": "Repository Descriptor schema",
    "type": "object",
    "required": ["location"],
    "properties": {
      "mode": {
        "type": "string",
        "enum": ["strict", "preferred", "available"],
        "default": "available"
      },
      "location": {
        "type": "array",
        "minItems": 1,
        "uniqueItems": true,
        "items": {
          "type": "object",
          "required": ["url", "name", "description"],
          "properties": {
            "url": {
              "type": "string",
              "format": "url"
            },
            "name": {
              "type": "string"
            },
            "description": {
              "type": "string"
            }
          }
        }
      }
    }
  },
  "security": {
    "title": "Security Descriptor Schema",
    "type": "object",
    "required": ["name", "authentication-method"],
    "properties": {
      "name": {"type": "string"},
      "scope": { "type": "string"},
      "authentication-method": {"type": "string"},
      "authority-url": {
        "type": "string",
        "format": "url"
      },
      "certificate": {"type": "string"},
      "auth-token": {"type": "string"},
      "client-grants": {"type": "string"},
      "auth-token-expires": {
        "type": "string",
        "format": "date-time"
      },
      "auth-token-renew": {"type ": "string"},
      "auth-token-rotation": {
        "type": "boolean",
        "default": false
      }
    }
  },
  "step": {
    "title": "Step Descriptor Schema",
    "type": "object",
    "minProperties": 1,
    "properties": {
      "direct": {
        "type": "string",
        "enum":["stream", "stateful", "stateless"],
        "default": "stream"
      },
      "segment-duration": {
        "type": "integer",
        "minimum": 0
      },
      "operating-units": {
        "type": "integer",
        "minimum": 0
      }
    }
  }
}